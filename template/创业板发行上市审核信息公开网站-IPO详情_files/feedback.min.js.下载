$(function(){var l,c,e={leading:!0,trailing:!1};function a(){var o=!1;window.owsModal.open({modalId:"#d",modalClass:"",remote:"/common/templates/feedback.htm",buttons:{confirm:{selector:".confirm",eventName:"click",handler:function(e){if(o)return i("请勿重复提交!"),!1;if(function(){var e=l.getApi().getValue(),a=$(".feedback-modal .key-word").val(),t=$(".feedback-modal .content-description").val(),o=$(".feedback-modal .feedback-code").val(),c=$(".content-description").val(),n=$(".feedback-modal .phone-text").val(),d=$(".feedback-modal .email-text").val();return"0"==e?(i("请选择问题类型!"),!1):""==a?(i("标题不能为空!"),!1):""==t?(i("内容描述不能为空!"),!1):IEVersion()<=9&&0<IEVersion()&&500<c.length?(i("问题描述最多输入500个字符！"),!1):n&&!u("phone",n)?(i("手机号码请输入以1开头的11位数字"),!1):d&&!u("email",d)?(i("请输入正确的邮箱格式，如name@sz.cn"),!1):""!=o||(i("验证码不能为空!"),!1)}()){var a={uuid:c,problemType:l.getApi().getValue(),mobile:$(".feedback-modal .phone-text").val(),email:$(".feedback-modal .email-text").val(),keyWord:$(".feedback-modal .key-word").val(),problemDesc:$(".feedback-modal .content-description").val(),code:$(".feedback-modal .feedback-code").val(),module:"pc",pageUrl:window.location.href},t=this;window.ajaxRequest({url:pathObj.feedback_path+"/index/feedback",type:"POST",data:JSON.stringify(a),dataType:"json",success:function(e){"0"==e.code?(i(e.msg,"#5573aa"),o=!0,setTimeout(function(){t.hide()},2e3)):i(e.msg)}})}}},cancel:{selector:".cancel",eventName:"click",handler:function(){this.hide()}}},onInitialized:function(){this.show(),window.ajaxRequest({url:pathObj.feedback_path+"/validatte/uid",type:"GET",async:!1,dataType:"json",success:function(e){c=e.uuid}}),window.ajaxRequest({url:pathObj.feedback_path+"/index/problemType",type:"GET",async:!0,dataType:"json",success:function(e){var a={data:"0"==e.code?e.problemType:[{text:"请选择",value:"0",selected:"selected"},{text:"功能出问题，不能正常使用",value:"1",selected:""},{text:"颜色、图标、字体等不好看",value:"2",selected:""},{text:"点击或浏览等交互效果不佳",value:"3",selected:""},{text:"内容不合适或缺失",value:"4",selected:""}],onSelected:function(){$(".question .c-selectex-container .dropdown").hasClass("open")&&$(".question .c-selectex-container .dropdown").removeClass("open")}};(l=new s.ui.controls.Selectex(".question-type",a)).getApi().setValue("0")}}),t(),$(".feedback-modal .modal-header .close").on("click",n),$(".feedback-modal .feedback-picture").off("click",t).on("click",t),iePlaceholderSuppose()}})}function i(e,a){var t=$(".show-message");t.show(),t.html(e),a&&t.css("background",a),setTimeout(function(){t.hide()},1500)}function t(){var e=pathObj.feedback_path+"/validatte/picture?uuid="+c+"&random="+Math.random();$(".feedback-modal .feedback-picture").attr("src",e),$(".feedback-modal .feedback-code").val("")}function n(){$(".show-message").hide()}function u(e,a){if("phone"==e)return/^1\d{10}$/.test(a);if("email"==e){return new RegExp("^([\\w-\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.)|(([\\w-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\\]?)$").test(a)}}$(".btn-feedback").on("click",_.debounce(a,300,e)),$(".footer-feedback").on("click",_.debounce(a,300,e)),$(".elevator_feedback").on("click",_.debounce(a,300,e))});